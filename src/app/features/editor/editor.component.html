<div class="editor-layout">
  <!-- Left Toolbar -->
  <aside class="toolbar toolbar-left">
    <div class="tool-group">
      <h3>Tools</h3>
      @for (tool of tools; track tool.type) {
        <button
          class="tool-btn"
          [class.active]="canvasService.activeTool() === tool.type"
          (click)="selectTool(tool.type)"
          [title]="tool.label"
        >
          <span class="tool-icon">{{ tool.icon }}</span>
          <span class="tool-label">{{ tool.label }}</span>
        </button>
      }
    </div>

    <div class="tool-group">
      <h3>Actions</h3>
      <button class="tool-btn" (click)="undo()" [disabled]="!historyService.canUndo()" title="Undo (Ctrl+Z)">
        <span class="tool-icon">&#x21A9;</span>
        <span class="tool-label">Undo</span>
      </button>
      <button class="tool-btn" (click)="redo()" [disabled]="!historyService.canRedo()" title="Redo (Ctrl+Shift+Z)">
        <span class="tool-icon">&#x21AA;</span>
        <span class="tool-label">Redo</span>
      </button>
      <button class="tool-btn" (click)="toggleGrid()" [class.active]="canvasService.showGrid()" title="Toggle Grid">
        <span class="tool-icon">#</span>
        <span class="tool-label">Grid</span>
      </button>
      <button class="tool-btn" (click)="clearCanvas()" title="Clear Canvas">
        <span class="tool-icon">&#x2715;</span>
        <span class="tool-label">Clear</span>
      </button>
    </div>

    <div class="tool-group">
      <h3>Size</h3>
      <select class="size-select" [(ngModel)]="selectedSize" (ngModelChange)="onSizeChange()">
        @for (s of sizes; track s) {
          <option [ngValue]="s">{{ s }}x{{ s }}</option>
        }
      </select>
    </div>

    <div class="tool-group">
      <h3>File</h3>
      <button class="tool-btn" (click)="save()" title="Save (Ctrl+S)">
        <span class="tool-icon">&#x1F4BE;</span>
        <span class="tool-label">Save</span>
      </button>
      <button class="tool-btn" (click)="exportPng()" title="Export PNG">
        <span class="tool-icon">&#x21E9;</span>
        <span class="tool-label">Export</span>
      </button>
    </div>
  </aside>

  <!-- Canvas Area -->
  <main class="canvas-area">
    <canvas
      #pixelCanvas
      class="pixel-canvas"
      (mousedown)="onMouseDown($event)"
      (mousemove)="onMouseMove($event)"
      (mouseup)="onMouseUp()"
      (mouseleave)="onMouseLeave()"
    ></canvas>
  </main>

  <!-- Right Panel -->
  <aside class="toolbar toolbar-right">
    <div class="tool-group">
      <h3>Active Color</h3>
      <div class="active-color-preview" [style.background-color]="canvasService.activeColor()"></div>
    </div>

    <div class="tool-group">
      <h3>Palette</h3>
      <select class="size-select" [ngModel]="canvasService.paletteName()" (ngModelChange)="selectPalette($event)">
        @for (name of paletteNames; track name) {
          <option [ngValue]="name">{{ name }}</option>
        }
      </select>
      <div class="palette-grid">
        @for (color of canvasService.palette(); track color) {
          <button
            class="swatch"
            [style.background-color]="color"
            [class.active]="canvasService.activeColor() === color"
            (click)="selectColor(color)"
            [title]="color"
          ></button>
        }
      </div>
    </div>
  </aside>
</div>
